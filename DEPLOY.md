# Деплой KARTO (Timeweb Cloud)

## Команды для панели приложения

- **Сборка:** `npm run build`
- **Запуск:** `npm run start`

Переменная окружения `PORT` должна быть задана (обычно панель подставляет сама).

## Важно для работы сайта

Сервер приложения должен получать **все** запросы к домену, в том числе:

- `/` — главная
- `/_next/static/...` — JS и CSS (чанки Next.js)
- `/api/...` — API-маршруты
- Любые другие пути приложения

Если прокси или настройки домена отдают только «главную страницу», а запросы к `/_next/*` не попадают в приложение (или отдаётся HTML вместо файлов), сайт будет открываться без стилей и с ошибками в консоли (`Unexpected token '<'`).

**Что проверить в Timeweb:**

1. В настройках приложения команда запуска именно `npm run start` (или `node .next/standalone/server.js`).
2. Нет ли «перехвата» путей вроде `/_next/*` на уровне прокси/nginx (все пути должны идти в Node-приложение).
3. При необходимости написать в поддержку: «Приложение Next.js: нужно, чтобы все запросы к домену (включая `/_next/static/*`) проксировались в Node-приложение, а не отдавался HTML».

После изменений в репозитории — сделать деплой заново (пересборку), чтобы подтянулись новые файлы.

---

## Рабочий вариант: деплой на Vercel (пока решают вопрос с Timeweb)

Vercel — платформа от создателей Next.js, сайт там заработает без возни с прокси. Можно использовать как постоянный хостинг или как временный, пока поддержка Timeweb не настроит прокси.

### Шаги (5–10 минут)

1. Зайдите на [vercel.com](https://vercel.com), войдите через GitHub.
2. **Add New… → Project** → выберите репозиторий **MonteCarlo2/Karto**.
3. Оставьте настройки по умолчанию (Framework: Next.js, Build Command: `npm run build`, Output: автоматически).
4. В **Environment Variables** добавьте те же переменные, что в `.env.local` (например `NEXT_PUBLIC_SUPABASE_URL`, `NEXT_PUBLIC_SUPABASE_ANON_KEY`, ключи для API и т.д.). Не загружайте сам файл `.env.local` — вводите только нужные имена и значения.
5. Нажмите **Deploy**. Дождитесь окончания сборки.
6. Сайт откроется по адресу вида `karto-xxx.vercel.app` — проверьте, что всё отображается и стили на месте.
7. Чтобы использовать свой домен **karto.pro**: в проекте Vercel откройте **Settings → Domains**, добавьте `karto.pro`. Vercel покажет, какие DNS-записи выставить (обычно A или CNAME). Поменяйте записи у регистратора домена на указанные Vercel — после обновления DNS сайт будет открываться по karto.pro через Vercel.

Код менять не нужно — этот репозиторий уже подходит для Vercel. После деплоя можно оставить сайт на Vercel или вернуть домен на Timeweb, когда они исправят отдачу статики.
