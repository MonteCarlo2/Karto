# Деплой KARTO (Timeweb Cloud)

## 1. Проверь next.config

В проекте должен быть **без** строки `output: 'export'`.  
Сейчас используется `output: "standalone"` — так и должно быть для Node.js на Timeweb.  
Режим `export` даёт статику в `/out`, тогда сервер не отдаёт JS/CSS — из-за этого и бывает ошибка «Unexpected token '<'».

## 2. Настройки в панели Timeweb (App Platform)

- **Директория сборки (Output / корень приложения):** строго корень репозитория (часто поле пустое или `.`). Не менять на `out` или что-то другое — нужна сборка в `.next`.
- **Команда сборки:** `npm run build`
- **Команда запуска:** `npm run start` (или оставить по умолчанию, если панель сама подставляет)

Переменная `PORT` обычно подставляется панелью.

## 3. Пересборка

После правок в репозитории и в настройках приложения:

1. В приложении Karto нажми **«Пересобрать»** / **Deploy**.
2. Выбери вариант **«Сбросить кэш и собрать»**, чтобы старые артефакты не мешали.

## 4. Если сайт всё ещё без стилей (Unexpected token '<')

Значит, запросы к `/_next/static/...` не доходят до Node или сервер отдаёт HTML вместо JS/CSS. Тогда:

- Убедись, что в настройках домена/прокси **все** запросы к домену идут в Node-приложение (нет правил, которые отдают только главную или режут `/_next/*`).
- В поддержку Timeweb можно написать: «Приложение Next.js: нужно, чтобы все запросы (включая `/_next/static/*`) проксировались в Node-приложение, а не отдавался HTML».
