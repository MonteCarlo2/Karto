# Детальная настройка SMTP для Рамблера

## ⚠️ Важно: Рамблер и SMTP

Рамблер может использовать разные SMTP серверы в зависимости от типа почты:
- `@rambler.ru` - основной домен
- `@ro.ru` - может использовать инфраструктуру Mail.ru
- `@lenta.ru`, `@myrambler.ru` и другие - также поддерживаются

## Шаг 1: Определите тип вашей почты

Проверьте, какой у вас email:
- Если `@rambler.ru` → используйте `smtp.rambler.ru`
- Если `@ro.ru` → попробуйте `smtp.mail.ru` (так как @ro.ru может использовать инфраструктуру Mail.ru)
- Если другой домен → попробуйте оба варианта

## Шаг 2: Получите пароль для внешних приложений

### Вариант А: Если есть настройка "Пароли приложений"

1. Зайдите в настройки почты Рамблер
2. Найдите раздел **"Безопасность"** или **"Пароли приложений"**
3. Создайте новый пароль для приложения
4. Название: **"KARTO Supabase"**
5. Скопируйте пароль

### Вариант Б: Используйте обычный пароль (менее безопасно)

Если нет настройки паролей приложений:
1. Используйте обычный пароль от почты
2. Убедитесь, что двухфакторная аутентификация включена

## Шаг 3: Настройка в Supabase

1. **Supabase Dashboard** → **Settings** → **Authentication** → **SMTP Settings**
2. Включите **"Enable Custom SMTP"**
3. Заполните настройки:

### Для @rambler.ru:
```
SMTP Host: smtp.rambler.ru
SMTP Port: 465 (SSL) или 587 (TLS)
SMTP User: ваш-email@rambler.ru (полный email)
SMTP Password: [пароль приложения или обычный пароль]
Sender Email: ваш-email@rambler.ru
Sender Name: KARTO
```

### Для @ro.ru (попробуйте Mail.ru SMTP):
```
SMTP Host: smtp.mail.ru
SMTP Port: 465 (SSL) или 587 (TLS)
SMTP User: ваш-email@ro.ru (полный email)
SMTP Password: [пароль приложения или обычный пароль]
Sender Email: ваш-email@ro.ru
Sender Name: KARTO
```

4. Нажмите **"Save"**

## Шаг 4: Проверка работы

1. Сохраните настройки в Supabase
2. Зарегистрируйте тестового пользователя
3. Проверьте логи: **Supabase Dashboard** → **Logs** → **Auth Logs**
4. Проверьте почту (включая папку "Спам")

## ⚠️ Если не работает

### Проблема 1: "Authentication failed"

**Решения:**
- Убедитесь, что используете полный email в поле "SMTP User"
- Проверьте пароль (скопирован полностью, без пробелов)
- Попробуйте другой порт (465 → 587 или наоборот)
- Для @ro.ru попробуйте `smtp.mail.ru` вместо `smtp.rambler.ru`

### Проблема 2: "Connection timeout"

**Решения:**
- Проверьте, что Host правильный
- Попробуйте порт 587 вместо 465
- Убедитесь, что нет блокировки файрвола

### Проблема 3: Письма не приходят

**Решения:**
- Проверьте папку "Спам"
- Проверьте логи в Supabase
- Убедитесь, что "Sender Email" совпадает с "SMTP User"

## Альтернатива: Использовать Mail.ru (если Рамблер не работает)

Если Рамблер не работает, можно создать почту на Mail.ru:

1. Зарегистрируйте `karto.help@mail.ru`
2. Создайте пароль для приложений: https://account.mail.ru/user/2-step-auth/passwords
3. Настройте в Supabase:
   ```
   Host: smtp.mail.ru
   Port: 465
   User: karto.help@mail.ru
   Password: [пароль для приложений]
   Sender Email: karto.help@mail.ru
   Sender Name: KARTO
   ```

## Для Яндекс OAuth

Для Яндекс OAuth нужна рабочая почта для создания приложения:
- Зайдите на https://oauth.yandex.ru/
- Создайте приложение
- Используйте вашу рабочую почту (Рамблер) для регистрации
- Это не требует SMTP, только email для аккаунта
